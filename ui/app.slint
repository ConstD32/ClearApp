// app.slint
import {
    VerticalBox,
    HorizontalBox,
    Button,
    GroupBox,
    LineEdit,
    StandardButton,
} from "std-widgets.slint";

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è
export struct TunnelData {
    name: string,
    local_port: int,
    remote_port: int,
    running: bool,
}

export component MainWindow inherits Window {
    in-out property <string> password: "";

    // –°–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Rust
    in-out property <string> server-ip;
    in-out property <string> username;
//    in-out property <string> key-path;

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç—É–Ω–Ω–µ–ª–µ–π
    in-out property <[TunnelData]> tunnels: [
        {
            name: "–¢—É–Ω–Ω–µ–ª—å 1",
            local_port: 60721,
            remote_port: 60721,
            running: false,
        },
        {
            name: "HTTPS",
            local_port: 8443,
            remote_port: 443,
            running: true,
        },
        {
            name: "DB",
            local_port: 5432,
            remote_port: 5432,
            running: false,
        },
    ];

    // Callbacks –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Rust
    callback start_tunnel(int);
    callback stop_tunnel(int);
//    callback reload_config();
//    callback save_config();

    // –°–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
//    private property <int> total_tunnels: root.tunnels.length;
//    in property <int> running_tunnels;

    title: "SSH Tunnel Manager";
    min-width: 600px;
    min-height: 800px;
    default-font-family: "Segoe UI";
//    default-font-size: 14px;

    VerticalBox {
        alignment: LayoutAlignment.stretch;
        spacing: 0px;

        // –ü–∞—Ä–æ–ª—å
        VerticalBox {
            Text {
                overflow: TextOverflow.clip;
                text: "–ü–∞—Ä–æ–ª—å –∫ –∫–ª—é—á—É:";
                vertical-alignment: center;
                horizontal-alignment: left;
            }

            LineEdit {
                placeholder-text: "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞";
                text <=> root.password;
                input-type: InputType.password;
            }
        }

        Rectangle { // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
            border-color: #000000;
            border-width: 1px;
            height: 1px;
        }

        // ===== –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è =====
//        HorizontalBox {
//            Text {
//                text: "Server IP: " + root.server_ip;
//            }
//
//            Text {
//                text: "Username: " + root.username;
//            }
//        }

//        Rectangle { // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
//            border-color: #000000;
//            border-width: 1px;
//            height: 1px;
//        }

        // –°–µ–∫—Ü–∏—è –¢—É–Ω–Ω–µ–ª–µ–π
        VerticalBox {
            spacing: 0px;
            alignment: LayoutAlignment.start;

            // ===== –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã =====
            for tunnel[index] in root.tunnels: GroupBox {
//                title: tunnel.name;

                Rectangle {
                    border-color: #000000;
                    border-width: 1px;
                    border-radius: 12px;

                    VerticalBox {
                        // üîπ –∫–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                            padding-left: 15px;
                        Text {
                            text: tunnel.name;
                        }

                        HorizontalBox {
                            Text {
                                text: tunnel.running ? "üü¢ –ê–∫—Ç–∏–≤–µ–Ω" : "üî¥ –û—Ç–∫–ª—é—á—ë–Ω";
                                color: tunnel.running ? green : red;
                                vertical-alignment: center;
                                width: 100px;
                            }

                            Text {
                                text: tunnel.local_port;
                                vertical-alignment: center;
                                width: 100px;
                            }

                            Text {
                                text: tunnel.remote_port;
                                vertical-alignment: center;
                                width: 100px;
                            }

                            Button {
                                text: "–ó–∞–ø—É—Å—Ç–∏—Ç—å";
                                width: 100px;
                                clicked => {
                                    root.start_tunnel(index);
                                }
                            }

                            Button {
                                text: "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å";
                                width: 100px;
                                enabled: false;
                                clicked => {
                                    root.stop_tunnel(index);
                                }
                            }
                        }
                    }
                }
            }

            Rectangle { // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
                border-color: #000000;
                border-width: 1px;
                height: 1px;
            }

//            HorizontalBox {
//                alignment: LayoutAlignment.end;
//                StandardButton {
//                    kind: close;
//                }
//            }
        }
    }
}
